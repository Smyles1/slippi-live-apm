{"version":3,"file":"slpReader.esm.js","sources":["../../src/utils/slpReader.ts"],"sourcesContent":["import { decode } from \"@shelacek/ubjson\";\nimport fs from \"fs\";\nimport iconv from \"iconv-lite\";\nimport { mapValues } from \"lodash\";\n\nimport type {\n  EventCallbackFunc,\n  EventPayloadTypes,\n  GeckoCodeType,\n  MetadataType,\n  PlacementType,\n  PlayerType,\n  SelfInducedSpeedsType,\n} from \"../types\";\nimport { Command } from \"../types\";\nimport { toHalfwidth } from \"./fullwidth\";\n\nexport enum SlpInputSource {\n  BUFFER = \"buffer\",\n  FILE = \"file\",\n}\n\nexport interface SlpReadInput {\n  source: SlpInputSource;\n  filePath?: string;\n  buffer?: Buffer;\n}\n\nexport type SlpRefType = SlpFileSourceRef | SlpBufferSourceRef;\n\nexport interface SlpFileType {\n  ref: SlpRefType;\n  rawDataPosition: number;\n  rawDataLength: number;\n  metadataPosition: number;\n  metadataLength: number;\n  messageSizes: {\n    [command: number]: number;\n  };\n}\n\nexport interface SlpFileSourceRef {\n  source: SlpInputSource;\n  fileDescriptor: number;\n}\n\nexport interface SlpBufferSourceRef {\n  source: SlpInputSource;\n  buffer: Buffer;\n}\n\nfunction getRef(input: SlpReadInput): SlpRefType {\n  switch (input.source) {\n    case SlpInputSource.FILE:\n      if (!input.filePath) {\n        throw new Error(\"File source requires a file path\");\n      }\n      const fd = fs.openSync(input.filePath, \"r\");\n      return {\n        source: input.source,\n        fileDescriptor: fd,\n      } as SlpFileSourceRef;\n    case SlpInputSource.BUFFER:\n      return {\n        source: input.source,\n        buffer: input.buffer,\n      } as SlpBufferSourceRef;\n    default:\n      throw new Error(\"Source type not supported\");\n  }\n}\n\nfunction readRef(ref: SlpRefType, buffer: Uint8Array, offset: number, length: number, position: number): number {\n  switch (ref.source) {\n    case SlpInputSource.FILE:\n      return fs.readSync((ref as SlpFileSourceRef).fileDescriptor, buffer, offset, length, position);\n    case SlpInputSource.BUFFER:\n      return (ref as SlpBufferSourceRef).buffer.copy(buffer, offset, position, position + length);\n    default:\n      throw new Error(\"Source type not supported\");\n  }\n}\n\nfunction getLenRef(ref: SlpRefType): number {\n  switch (ref.source) {\n    case SlpInputSource.FILE:\n      const fileStats = fs.fstatSync((ref as SlpFileSourceRef).fileDescriptor);\n      return fileStats.size;\n    case SlpInputSource.BUFFER:\n      return (ref as SlpBufferSourceRef).buffer.length;\n    default:\n      throw new Error(\"Source type not supported\");\n  }\n}\n\n/**\n * Opens a file at path\n */\nexport function openSlpFile(input: SlpReadInput): SlpFileType {\n  const ref = getRef(input);\n\n  const rawDataPosition = getRawDataPosition(ref);\n  const rawDataLength = getRawDataLength(ref, rawDataPosition);\n  const metadataPosition = rawDataPosition + rawDataLength + 10; // remove metadata string\n  const metadataLength = getMetadataLength(ref, metadataPosition);\n  const messageSizes = getMessageSizes(ref, rawDataPosition);\n\n  return {\n    ref,\n    rawDataPosition,\n    rawDataLength,\n    metadataPosition,\n    metadataLength,\n    messageSizes,\n  };\n}\n\nexport function closeSlpFile(file: SlpFileType): void {\n  switch (file.ref.source) {\n    case SlpInputSource.FILE:\n      fs.closeSync((file.ref as SlpFileSourceRef).fileDescriptor);\n      break;\n  }\n}\n\n// This function gets the position where the raw data starts\nfunction getRawDataPosition(ref: SlpRefType): number {\n  const buffer = new Uint8Array(1);\n  readRef(ref, buffer, 0, buffer.length, 0);\n\n  if (buffer[0] === 0x36) {\n    return 0;\n  }\n\n  if (buffer[0] !== \"{\".charCodeAt(0)) {\n    return 0; // return error?\n  }\n\n  return 15;\n}\n\nfunction getRawDataLength(ref: SlpRefType, position: number): number {\n  const fileSize = getLenRef(ref);\n  if (position === 0) {\n    return fileSize;\n  }\n\n  const buffer = new Uint8Array(4);\n  readRef(ref, buffer, 0, buffer.length, position - 4);\n\n  const rawDataLen = (buffer[0]! << 24) | (buffer[1]! << 16) | (buffer[2]! << 8) | buffer[3]!;\n  if (rawDataLen > 0) {\n    // If this method manages to read a number, it's probably trustworthy\n    return rawDataLen;\n  }\n\n  // If the above does not return a valid data length,\n  // return a file size based on file length. This enables\n  // some support for severed files\n  return fileSize - position;\n}\n\nfunction getMetadataLength(ref: SlpRefType, position: number): number {\n  const len = getLenRef(ref);\n  return len - position - 1;\n}\n\nfunction getMessageSizes(\n  ref: SlpRefType,\n  position: number,\n): {\n  [command: number]: number;\n} {\n  const messageSizes: {\n    [command: number]: number;\n  } = {};\n  // Support old file format\n  if (position === 0) {\n    messageSizes[0x36] = 0x140;\n    messageSizes[0x37] = 0x6;\n    messageSizes[0x38] = 0x46;\n    messageSizes[0x39] = 0x1;\n    return messageSizes;\n  }\n\n  const buffer = new Uint8Array(2);\n  readRef(ref, buffer, 0, buffer.length, position);\n  if (buffer[0] !== Command.MESSAGE_SIZES) {\n    return {};\n  }\n\n  const payloadLength = buffer[1] as number;\n  (messageSizes[0x35] as any) = payloadLength;\n\n  const messageSizesBuffer = new Uint8Array(payloadLength - 1);\n  readRef(ref, messageSizesBuffer, 0, messageSizesBuffer.length, position + 2);\n  for (let i = 0; i < payloadLength - 1; i += 3) {\n    const command = messageSizesBuffer[i] as number;\n\n    // Get size of command\n    (messageSizes[command] as any) = (messageSizesBuffer[i + 1]! << 8) | messageSizesBuffer[i + 2]!;\n  }\n\n  return messageSizes;\n}\n\n/**\n * Iterates through slp events and parses payloads\n */\nexport function iterateEvents(\n  slpFile: SlpFileType,\n  callback: EventCallbackFunc,\n  startPos: number | null = null,\n): number {\n  const ref = slpFile.ref;\n\n  let readPosition = startPos !== null && startPos > 0 ? startPos : slpFile.rawDataPosition;\n  const stopReadingAt = slpFile.rawDataPosition + slpFile.rawDataLength;\n\n  // Generate read buffers for each\n  const commandPayloadBuffers = mapValues(slpFile.messageSizes, (size) => new Uint8Array(size + 1));\n  let splitMessageBuffer = new Uint8Array(0);\n\n  const commandByteBuffer = new Uint8Array(1);\n  while (readPosition < stopReadingAt) {\n    readRef(ref, commandByteBuffer, 0, 1, readPosition);\n    let commandByte = (commandByteBuffer[0] as number) ?? 0;\n    let buffer = commandPayloadBuffers[commandByte];\n    if (buffer === undefined) {\n      // If we don't have an entry for this command, return false to indicate failed read\n      return readPosition;\n    }\n\n    if (buffer.length > stopReadingAt - readPosition) {\n      return readPosition;\n    }\n\n    const advanceAmount = buffer.length;\n\n    readRef(ref, buffer, 0, buffer.length, readPosition);\n    if (commandByte === Command.SPLIT_MESSAGE) {\n      // Here we have a split message, we will collect data from them until the last\n      // message of the list is received\n      const view = new DataView(buffer.buffer);\n      const size = readUint16(view, 0x201) ?? 512;\n      const isLastMessage = readBool(view, 0x204);\n      const internalCommand = readUint8(view, 0x203) ?? 0;\n\n      // If this is the first message, initialize the splitMessageBuffer\n      // with the internal command byte because our parseMessage function\n      // seems to expect a command byte at the start\n      if (splitMessageBuffer.length === 0) {\n        splitMessageBuffer = new Uint8Array(1);\n        splitMessageBuffer[0] = internalCommand;\n      }\n\n      // Collect new data into splitMessageBuffer\n      const appendBuf = buffer.slice(0x1, 0x1 + size);\n      const mergedBuf = new Uint8Array(splitMessageBuffer.length + appendBuf.length);\n      mergedBuf.set(splitMessageBuffer);\n      mergedBuf.set(appendBuf, splitMessageBuffer.length);\n      splitMessageBuffer = mergedBuf;\n\n      if (isLastMessage) {\n        commandByte = splitMessageBuffer[0] ?? 0;\n        buffer = splitMessageBuffer;\n        splitMessageBuffer = new Uint8Array(0);\n      }\n    }\n\n    const parsedPayload = parseMessage(commandByte, buffer);\n    const shouldStop = callback(commandByte, parsedPayload);\n    if (shouldStop) {\n      break;\n    }\n\n    readPosition += advanceAmount;\n  }\n\n  return readPosition;\n}\n\nexport function parseMessage(command: Command, payload: Uint8Array): EventPayloadTypes | null {\n  const view = new DataView(payload.buffer);\n  switch (command) {\n    case Command.GAME_START:\n      const getPlayerObject = (playerIndex: number): PlayerType => {\n        // Controller Fix stuff\n        const cfOffset = playerIndex * 0x8;\n        const dashback = readUint32(view, 0x141 + cfOffset);\n        const shieldDrop = readUint32(view, 0x145 + cfOffset);\n        let controllerFix = \"None\";\n        if (dashback !== shieldDrop) {\n          controllerFix = \"Mixed\";\n        } else if (dashback === 1) {\n          controllerFix = \"UCF\";\n        } else if (dashback === 2) {\n          controllerFix = \"Dween\";\n        }\n\n        // Nametag stuff\n        const nametagLength = 0x10;\n        const nametagOffset = playerIndex * nametagLength;\n        const nametagStart = 0x161 + nametagOffset;\n        const nametagBuf = payload.slice(nametagStart, nametagStart + nametagLength);\n        const nameTagString = iconv\n          .decode(nametagBuf as Buffer, \"Shift_JIS\")\n          .split(\"\\0\")\n          .shift();\n        const nametag = nameTagString ? toHalfwidth(nameTagString) : \"\";\n\n        // Display name\n        const displayNameLength = 0x1f;\n        const displayNameOffset = playerIndex * displayNameLength;\n        const displayNameStart = 0x1a5 + displayNameOffset;\n        const displayNameBuf = payload.slice(displayNameStart, displayNameStart + displayNameLength);\n        const displayNameString = iconv\n          .decode(displayNameBuf as Buffer, \"Shift_JIS\")\n          .split(\"\\0\")\n          .shift();\n        const displayName = displayNameString ? toHalfwidth(displayNameString) : \"\";\n\n        // Connect code\n        const connectCodeLength = 0xa;\n        const connectCodeOffset = playerIndex * connectCodeLength;\n        const connectCodeStart = 0x221 + connectCodeOffset;\n        const connectCodeBuf = payload.slice(connectCodeStart, connectCodeStart + connectCodeLength);\n        const connectCodeString = iconv\n          .decode(connectCodeBuf as Buffer, \"Shift_JIS\")\n          .split(\"\\0\")\n          .shift();\n        const connectCode = connectCodeString ? toHalfwidth(connectCodeString) : \"\";\n\n        const userIdLength = 0x1d;\n        const userIdOffset = playerIndex * userIdLength;\n        const userIdStart = 0x249 + userIdOffset;\n        const userIdBuf = payload.slice(userIdStart, userIdStart + userIdLength);\n        const userIdString = iconv\n          .decode(userIdBuf as Buffer, \"utf8\")\n          .split(\"\\0\")\n          .shift();\n        const userId = userIdString ?? \"\";\n\n        const offset = playerIndex * 0x24;\n        return {\n          playerIndex,\n          port: playerIndex + 1,\n          characterId: readUint8(view, 0x65 + offset),\n          characterColor: readUint8(view, 0x68 + offset),\n          startStocks: readUint8(view, 0x67 + offset),\n          type: readUint8(view, 0x66 + offset),\n          teamId: readUint8(view, 0x6e + offset),\n          controllerFix,\n          nametag,\n          displayName,\n          connectCode,\n          userId,\n        };\n      };\n      return {\n        slpVersion: `${readUint8(view, 0x1)}.${readUint8(view, 0x2)}.${readUint8(view, 0x3)}`,\n        isTeams: readBool(view, 0xd),\n        isPAL: readBool(view, 0x1a1),\n        stageId: readUint16(view, 0x13),\n        players: [0, 1, 2, 3].map(getPlayerObject),\n        scene: readUint8(view, 0x1a3),\n        gameMode: readUint8(view, 0x1a4),\n        language: readUint8(view, 0x2bd),\n      };\n    case Command.FRAME_START:\n      return {\n        frame: readInt32(view, 0x1),\n        seed: readUint32(view, 0x5),\n        sceneFrameCounter: readUint32(view, 0x9),\n      };\n    case Command.PRE_FRAME_UPDATE:\n      return {\n        frame: readInt32(view, 0x1),\n        playerIndex: readUint8(view, 0x5),\n        isFollower: readBool(view, 0x6),\n        seed: readUint32(view, 0x7),\n        actionStateId: readUint16(view, 0xb),\n        positionX: readFloat(view, 0xd),\n        positionY: readFloat(view, 0x11),\n        facingDirection: readFloat(view, 0x15),\n        joystickX: readFloat(view, 0x19),\n        joystickY: readFloat(view, 0x1d),\n        cStickX: readFloat(view, 0x21),\n        cStickY: readFloat(view, 0x25),\n        trigger: readFloat(view, 0x29),\n        buttons: readUint32(view, 0x2d),\n        physicalButtons: readUint16(view, 0x31),\n        physicalLTrigger: readFloat(view, 0x33),\n        physicalRTrigger: readFloat(view, 0x37),\n        rawJoystickX: readInt8(view, 0x3b),\n        percent: readFloat(view, 0x3c),\n      };\n    case Command.POST_FRAME_UPDATE:\n      const selfInducedSpeeds: SelfInducedSpeedsType = {\n        airX: readFloat(view, 0x35),\n        y: readFloat(view, 0x39),\n        attackX: readFloat(view, 0x3d),\n        attackY: readFloat(view, 0x41),\n        groundX: readFloat(view, 0x45),\n      };\n      return {\n        frame: readInt32(view, 0x1),\n        playerIndex: readUint8(view, 0x5),\n        isFollower: readBool(view, 0x6),\n        internalCharacterId: readUint8(view, 0x7),\n        actionStateId: readUint16(view, 0x8),\n        positionX: readFloat(view, 0xa),\n        positionY: readFloat(view, 0xe),\n        facingDirection: readFloat(view, 0x12),\n        percent: readFloat(view, 0x16),\n        shieldSize: readFloat(view, 0x1a),\n        lastAttackLanded: readUint8(view, 0x1e),\n        currentComboCount: readUint8(view, 0x1f),\n        lastHitBy: readUint8(view, 0x20),\n        stocksRemaining: readUint8(view, 0x21),\n        actionStateCounter: readFloat(view, 0x22),\n        miscActionState: readFloat(view, 0x2b),\n        isAirborne: readBool(view, 0x2f),\n        lastGroundId: readUint16(view, 0x30),\n        jumpsRemaining: readUint8(view, 0x32),\n        lCancelStatus: readUint8(view, 0x33),\n        hurtboxCollisionState: readUint8(view, 0x34),\n        selfInducedSpeeds: selfInducedSpeeds,\n        hitlagRemaining: readFloat(view, 0x49),\n        animationIndex: readUint32(view, 0x4d),\n      };\n    case Command.ITEM_UPDATE:\n      return {\n        frame: readInt32(view, 0x1),\n        typeId: readUint16(view, 0x5),\n        state: readUint8(view, 0x7),\n        facingDirection: readFloat(view, 0x8),\n        velocityX: readFloat(view, 0xc),\n        velocityY: readFloat(view, 0x10),\n        positionX: readFloat(view, 0x14),\n        positionY: readFloat(view, 0x18),\n        damageTaken: readUint16(view, 0x1c),\n        expirationTimer: readFloat(view, 0x1e),\n        spawnId: readUint32(view, 0x22),\n        missileType: readUint8(view, 0x26),\n        turnipFace: readUint8(view, 0x27),\n        chargeShotLaunched: readUint8(view, 0x28),\n        chargePower: readUint8(view, 0x29),\n        owner: readInt8(view, 0x2a),\n      };\n    case Command.FRAME_BOOKEND:\n      return {\n        frame: readInt32(view, 0x1),\n        latestFinalizedFrame: readInt32(view, 0x5),\n      };\n    case Command.GAME_END:\n      const placements = [0, 1, 2, 3].map((playerIndex): PlacementType => {\n        const position = readInt8(view, 0x3 + playerIndex);\n        return { playerIndex, position };\n      });\n\n      return {\n        gameEndMethod: readUint8(view, 0x1),\n        lrasInitiatorIndex: readInt8(view, 0x2),\n        placements,\n      };\n    case Command.GECKO_LIST:\n      const codes: GeckoCodeType[] = [];\n      let pos = 1;\n      while (pos < payload.length) {\n        const word1 = readUint32(view, pos) ?? 0;\n        const codetype = (word1 >> 24) & 0xfe;\n        const address = (word1 & 0x01ffffff) + 0x80000000;\n\n        let offset = 8; // Default code length, most codes are this length\n        if (codetype === 0xc0 || codetype === 0xc2) {\n          const lineCount = readUint32(view, pos + 4) ?? 0;\n          offset = 8 + lineCount * 8;\n        } else if (codetype === 0x06) {\n          const byteLen = readUint32(view, pos + 4) ?? 0;\n          offset = 8 + ((byteLen + 7) & 0xfffffff8);\n        } else if (codetype === 0x08) {\n          offset = 16;\n        }\n\n        codes.push({\n          type: codetype,\n          address: address,\n          contents: payload.slice(pos, pos + offset),\n        });\n\n        pos += offset;\n      }\n\n      return {\n        contents: payload.slice(1),\n        codes: codes,\n      };\n    default:\n      return null;\n  }\n}\n\nfunction canReadFromView(view: DataView, offset: number, length: number): boolean {\n  const viewLength = view.byteLength;\n  return offset + length <= viewLength;\n}\n\nfunction readFloat(view: DataView, offset: number): number | null {\n  if (!canReadFromView(view, offset, 4)) {\n    return null;\n  }\n\n  return view.getFloat32(offset);\n}\n\nfunction readInt32(view: DataView, offset: number): number | null {\n  if (!canReadFromView(view, offset, 4)) {\n    return null;\n  }\n\n  return view.getInt32(offset);\n}\n\nfunction readInt8(view: DataView, offset: number): number | null {\n  if (!canReadFromView(view, offset, 1)) {\n    return null;\n  }\n\n  return view.getInt8(offset);\n}\n\nfunction readUint32(view: DataView, offset: number): number | null {\n  if (!canReadFromView(view, offset, 4)) {\n    return null;\n  }\n\n  return view.getUint32(offset);\n}\n\nfunction readUint16(view: DataView, offset: number): number | null {\n  if (!canReadFromView(view, offset, 2)) {\n    return null;\n  }\n\n  return view.getUint16(offset);\n}\n\nfunction readUint8(view: DataView, offset: number): number | null {\n  if (!canReadFromView(view, offset, 1)) {\n    return null;\n  }\n\n  return view.getUint8(offset);\n}\n\nfunction readBool(view: DataView, offset: number): boolean | null {\n  if (!canReadFromView(view, offset, 1)) {\n    return null;\n  }\n\n  return !!view.getUint8(offset);\n}\n\nexport function getMetadata(slpFile: SlpFileType): MetadataType | null {\n  if (slpFile.metadataLength <= 0) {\n    // This will happen on a severed incomplete file\n    // $FlowFixMe\n    return null;\n  }\n\n  const buffer = new Uint8Array(slpFile.metadataLength);\n\n  readRef(slpFile.ref, buffer, 0, buffer.length, slpFile.metadataPosition);\n\n  let metadata = null;\n  try {\n    metadata = decode(buffer);\n  } catch (ex) {\n    // Do nothing\n    // console.log(ex);\n  }\n\n  // $FlowFixMe\n  return metadata;\n}\n"],"names":["SlpInputSource","getRef","input","source","FILE","filePath","Error","fd","fs","openSync","fileDescriptor","BUFFER","buffer","readRef","ref","offset","length","position","readSync","copy","getLenRef","fileStats","fstatSync","size","openSlpFile","rawDataPosition","getRawDataPosition","rawDataLength","getRawDataLength","metadataPosition","metadataLength","getMetadataLength","messageSizes","getMessageSizes","closeSlpFile","file","closeSync","Uint8Array","charCodeAt","fileSize","rawDataLen","len","Command","MESSAGE_SIZES","payloadLength","messageSizesBuffer","i","command","iterateEvents","slpFile","callback","startPos","readPosition","stopReadingAt","commandPayloadBuffers","mapValues","splitMessageBuffer","commandByteBuffer","commandByte","undefined","advanceAmount","SPLIT_MESSAGE","view","DataView","readUint16","isLastMessage","readBool","internalCommand","readUint8","appendBuf","slice","mergedBuf","set","parsedPayload","parseMessage","shouldStop","payload","GAME_START","getPlayerObject","playerIndex","cfOffset","dashback","readUint32","shieldDrop","controllerFix","nametagLength","nametagOffset","nametagStart","nametagBuf","nameTagString","iconv","decode","split","shift","nametag","toHalfwidth","displayNameLength","displayNameOffset","displayNameStart","displayNameBuf","displayNameString","displayName","connectCodeLength","connectCodeOffset","connectCodeStart","connectCodeBuf","connectCodeString","connectCode","userIdLength","userIdOffset","userIdStart","userIdBuf","userIdString","userId","port","characterId","characterColor","startStocks","type","teamId","slpVersion","isTeams","isPAL","stageId","players","map","scene","gameMode","language","FRAME_START","frame","readInt32","seed","sceneFrameCounter","PRE_FRAME_UPDATE","isFollower","actionStateId","positionX","readFloat","positionY","facingDirection","joystickX","joystickY","cStickX","cStickY","trigger","buttons","physicalButtons","physicalLTrigger","physicalRTrigger","rawJoystickX","readInt8","percent","POST_FRAME_UPDATE","selfInducedSpeeds","airX","y","attackX","attackY","groundX","internalCharacterId","shieldSize","lastAttackLanded","currentComboCount","lastHitBy","stocksRemaining","actionStateCounter","miscActionState","isAirborne","lastGroundId","jumpsRemaining","lCancelStatus","hurtboxCollisionState","hitlagRemaining","animationIndex","ITEM_UPDATE","typeId","state","velocityX","velocityY","damageTaken","expirationTimer","spawnId","missileType","turnipFace","chargeShotLaunched","chargePower","owner","FRAME_BOOKEND","latestFinalizedFrame","GAME_END","placements","gameEndMethod","lrasInitiatorIndex","GECKO_LIST","codes","pos","word1","codetype","address","lineCount","byteLen","push","contents","canReadFromView","viewLength","byteLength","getFloat32","getInt32","getInt8","getUint32","getUint16","getUint8","getMetadata","metadata","ex"],"mappings":"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"}